$(function(){function s(){u("page");window.start_loading=function(){o(true)};window.end_loading=function(){o(true)}}function o(n){if(n){e.append(t);$(".loader").fadeIn(300);i=false}else{$(".loader").fadeOut(300,function(){$(this).remove()});i=true}}function u(e){var t,n;switch(e){case"page":t='div[data-role="page"]';n="page current";break;case"next_page":t='div[data-role="page"]:not(.current)';n="page next";break;case"dialog":t='div[data-role="dialog"]';n="dialog";break;case"lightbox":t='div[data-role="lightbox"]';n="lightbox";break}$(t).each(function(){var e=$(this);var t=e.data("theme");var r=e.data("title");if(t){e.addClass("theme_"+t)}if(r){e.attr("id",r)}e.addClass(n)})}function a(t){var n=t.data("direction");var r=t.data("transition");var i=t.attr("href")?t.attr("href"):t.data("url");o(true);$.event.trigger({type:"page_load",page:i});$.get(i,function(t){var s=$(t);var a=$(s.filter(".content")).data("role");switch(a){case"page":$(e).append(s.filter(".content"));u("next_page");switch(r){case"slide":c(n);break;case"fade":h();break;default:p();break}break;case"dialog":f(s,r);break;case"lightbox":l(s,r);break}o(false);$.event.trigger({type:"page_loaded",page:i,role:a})})}function f(t,i){$(e).append(n);$("body > .overlay").fadeIn(300);$(e).append(t.filter(".content"));u("dialog");var s=$(".dialog .contents").html();$(".dialog").append(r);$(".dialog .contents").html('<div class="scroll">'+s+"</div>");switch(i){case"slide":$(".dialog").show().addClass("slide");break;case"fade":$(".dialog").fadeIn(300);break}}function l(t,i){$(e).append(n);$("body > .overlay").fadeIn(300);$(e).append(t.filter(".content"));u("lightbox");$(".lightbox").append(r);switch(i){case"slide":$(".lightbox").show().addClass("slide");break;case"fade":$(".lightbox").fadeIn(300);break}}function c(e){var t;var t=e?"reverse_slide":"slide";$(".page.next").show().addClass(t);$(".page.current").addClass(t).addClass("remove");$(".page.next."+t).bind("animationend webkitAnimationEnd MSAnimationEnd oAnimationEnd",function(e){$(".page.next").removeClass("next reverse_slide slide").addClass("current");$(".page.remove").remove()})}function h(){$(".page.current").addClass("remove");$(".page.next").hide().fadeIn(500,function(){$(".page.next").removeClass("next").addClass("current");$(".page.remove").remove()})}function p(){$(".page.current").addClass("remove");$(".page.next").show();$(".page.next").removeClass("next").addClass("current");$(".page.remove").remove()}function d(e){e.html("")}var e=$("body");var t=$('<div class="loader">LOADING</div>');var n=$('<div class="overlay"></div>');var r=$('<div class="close_btn">x</div>');var i=true;s();$(e).delegate('[data-role="navigate"]',"click",function(){if(i){a($(this))}return false});$(e).delegate(".close_btn","click",function(){if(i){if(!$(this).parent().hasClass("slide")){$(".dialog,.lightbox").fadeOut(300,function(){$(this).remove()})}else{$(".dialog,.lightbox").removeClass("slide").addClass("slide_up");$(".dialog.slide_up,.lightbox.slide_up").bind("animationend webkitAnimationEnd MSAnimationEnd oAnimationEnd",function(e){$(this).remove()})}$("body > .overlay").fadeOut(300,function(){$(this).remove()})}return false})})